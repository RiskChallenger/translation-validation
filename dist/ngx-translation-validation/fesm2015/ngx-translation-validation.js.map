{"version":3,"file":"ngx-translation-validation.js","sources":["../../../projects/ngx-translation-validation/src/lib/ngx-tv-container.directive.ts","../../../projects/ngx-translation-validation/src/lib/ngx-tv-form.directive.ts","../../../projects/ngx-translation-validation/src/lib/ngx-tv-scope.directive.ts","../../../projects/ngx-translation-validation/src/lib/ngx-tv.config.ts","../../../projects/ngx-translation-validation/src/lib/ngx-tv.directive.ts","../../../projects/ngx-translation-validation/src/lib/ngx-tv-container/ngx-tv-container.component.ts","../../../projects/ngx-translation-validation/src/lib/ngx-tv.module.ts","../../../projects/ngx-translation-validation/src/public-api.ts","../../../projects/ngx-translation-validation/src/ngx-translation-validation.ts"],"sourcesContent":["import { Directive, ViewContainerRef } from '@angular/core';\n\n@Directive({\n  // tslint:disable-next-line:directive-selector\n  selector: '[ngxTvContainer]',\n})\nexport class NgxTvContainerDirective {\n  constructor(public vcr: ViewContainerRef) {}\n}\n","import { Directive, ElementRef, EventEmitter, Self } from '@angular/core';\nimport { ControlContainer, FormGroup, FormGroupDirective, NgControl, NgForm, NgModelGroup } from '@angular/forms';\nimport { EMPTY, fromEvent, Observable } from 'rxjs';\nimport { shareReplay, tap } from 'rxjs/operators';\n\n@Directive({\n  // tslint:disable-next-line:directive-selector\n  selector: '[formGroup]',\n})\nexport class NgxTvFormDirective {\n  submit$ = this.hostFormGroup.ngSubmit;\n\n  constructor(private host: ElementRef<HTMLFormElement>, private hostFormGroup: FormGroupDirective) {}\n\n  get onBlur(): boolean {\n    return this.hostFormGroup.form.updateOn === 'blur';\n  }\n  get onSubmit(): boolean {\n    return this.hostFormGroup.form.updateOn === 'submit';\n  }\n  get element(): HTMLElement {\n    return this.host.nativeElement;\n  }\n}\n","import { Directive, Input } from '@angular/core';\n\n@Directive({\n  // tslint:disable-next-line:directive-selector\n  selector: '[ngxTvScope]',\n})\nexport class NgxTvScopeDirective {\n  // tslint:disable-next-line:variable-name\n  private _scope?: string;\n\n  @Input()\n  set ngxTvScope(scope: string) {\n    this._scope = scope;\n  }\n\n  get scope(): string | undefined {\n    return this._scope;\n  }\n}\n","import { InjectionToken, Type } from '@angular/core';\nimport { NgxTvContainerComponent } from './ngx-tv-container/ngx-tv-container.component';\n\nexport interface NgxTvConfig {\n  scope: string;\n  invalidClass?: string;\n  submittedClass?: string;\n  errorsComponent: Type<NgxTvContainerComponent>;\n}\n\nexport const NGX_TV_CONFIG = new InjectionToken('NGX_TV_CONFIG');\n","import {\n  ComponentFactoryResolver,\n  ComponentRef,\n  Directive,\n  ElementRef,\n  Host,\n  Inject,\n  OnDestroy,\n  OnInit,\n  Optional,\n  Self,\n  ViewContainerRef,\n} from '@angular/core';\nimport { NgControl } from '@angular/forms';\nimport { EMPTY, fromEvent, merge, Observable, Subscription } from 'rxjs';\nimport { shareReplay, tap } from 'rxjs/operators';\nimport { NgxTvContainerDirective } from './ngx-tv-container.directive';\nimport { NgxTvContainerComponent } from './ngx-tv-container/ngx-tv-container.component';\nimport { NgxTvFormDirective } from './ngx-tv-form.directive';\nimport { NgxTvScopeDirective } from './ngx-tv-scope.directive';\nimport { NGX_TV_CONFIG, NgxTvConfig } from './ngx-tv.config';\n\n@Directive({\n  // tslint:disable-next-line:directive-selector\n  selector: '[formControl], [formControlName]',\n})\nexport class NgxTvDirective implements OnInit, OnDestroy {\n  ref?: ComponentRef<NgxTvContainerComponent>;\n  submit$!: Observable<Event>;\n  container!: ViewContainerRef;\n  blur$!: Observable<Event>;\n  context: string | undefined;\n\n  statusChangesObservable!: Subscription;\n\n  constructor(\n    private host: ElementRef<HTMLFormElement>,\n    private vcr: ViewContainerRef,\n    private resolver: ComponentFactoryResolver,\n    @Self() private controlDir: NgControl,\n    @Inject(NGX_TV_CONFIG) private config: NgxTvConfig,\n    @Optional() private controlErrorContainer?: NgxTvContainerDirective,\n    @Optional() private controlErrorContext?: NgxTvScopeDirective,\n    @Optional() @Host() private form?: NgxTvFormDirective\n  ) {}\n\n  get element(): HTMLFormElement {\n    return this.host.nativeElement;\n  }\n\n  ngOnInit(): void {\n    this.submit$ =\n      this.form?.submit$.pipe(\n        tap(() => {\n          this.addSubmittedClass();\n        })\n      ) ?? EMPTY;\n    this.blur$ = !this.form?.onSubmit ? fromEvent(this.element, 'blur').pipe(shareReplay(1)) : EMPTY;\n    this.container = this.controlErrorContainer?.vcr ?? this.vcr;\n    this.context = this.controlErrorContext?.scope ?? 'general';\n\n    this.statusChangesObservable = merge(this.submit$, this.blur$, this.controlDir.statusChanges || EMPTY).subscribe(\n      () => {\n        const controlErrors = this.controlDir.errors;\n        if (controlErrors) {\n          const firstKey = Object.keys(controlErrors)[0];\n          this.setError(`${this.config.scope}.${this.context}.${this.controlDir.name}.${firstKey}`);\n        } else if (this.ref) {\n          this.setError(null);\n        }\n      }\n    );\n  }\n\n  ngOnDestroy(): void {\n    this.statusChangesObservable.unsubscribe();\n  }\n\n  addSubmittedClass(): void {\n    if (this.config.submittedClass) {\n      this.form?.element.classList.add(this.config.submittedClass);\n    }\n  }\n\n  addInvalidClass(): void {\n    if (this.config.invalidClass) {\n      this.host.nativeElement.classList.add(this.config.invalidClass);\n    }\n  }\n\n  removeInvalidClass(): void {\n    if (this.config.invalidClass) {\n      this.host.nativeElement.classList.remove(this.config.invalidClass);\n    }\n  }\n\n  private setError(errorText: string | null): void {\n    if (!this.ref && errorText) {\n      const factory = this.resolver.resolveComponentFactory(this.config.errorsComponent);\n      this.ref = this.container.createComponent(factory);\n      this.addInvalidClass();\n    }\n    if (this.ref) {\n      this.ref.instance.text = errorText;\n    }\n\n    if (this.ref && errorText === null) {\n      this.ref.destroy();\n      this.removeInvalidClass();\n      this.ref = undefined;\n    }\n  }\n}\n","import { ChangeDetectionStrategy, ChangeDetectorRef, Component, Input } from '@angular/core';\n\n@Component({\n  // tslint:disable-next-line:component-selector\n  selector: 'ngx-tv-container',\n  templateUrl: './ngx-tv-container.component.html',\n  styleUrls: ['./ngx-tv-container.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class NgxTvContainerComponent {\n  componentText?: string;\n  componentHide = true;\n\n  @Input() set text(value: string | null) {\n    if (value !== this.componentText) {\n      this.componentHide = !value;\n      this.componentText = value || '';\n      this.cdr.detectChanges();\n    }\n  }\n\n  constructor(private cdr: ChangeDetectorRef) {}\n}\n","import { CommonModule } from '@angular/common';\nimport { ModuleWithProviders, NgModule } from '@angular/core';\nimport { TRANSLOCO_SCOPE, TranslocoModule } from '@ngneat/transloco';\nimport { NgxTvContainerDirective } from './ngx-tv-container.directive';\nimport { NgxTvContainerComponent } from './ngx-tv-container/ngx-tv-container.component';\nimport { NgxTvFormDirective } from './ngx-tv-form.directive';\nimport { NgxTvScopeDirective } from './ngx-tv-scope.directive';\nimport { NGX_TV_CONFIG, NgxTvConfig } from './ngx-tv.config';\nimport { NgxTvDirective } from './ngx-tv.directive';\n\nexport function getConfig(config?: Partial<NgxTvConfig>): NgxTvConfig {\n  return {\n    scope: 'validation',\n    submittedClass: 'ng-submitted',\n    errorsComponent: NgxTvContainerComponent,\n    invalidClass: undefined,\n    ...config,\n  };\n}\n\n@NgModule({\n  declarations: [\n    NgxTvDirective,\n    NgxTvFormDirective,\n    NgxTvContainerComponent,\n    NgxTvContainerDirective,\n    NgxTvScopeDirective,\n  ],\n  imports: [CommonModule, TranslocoModule],\n  exports: [NgxTvDirective, NgxTvFormDirective, NgxTvContainerComponent, NgxTvContainerDirective, NgxTvScopeDirective],\n})\nexport class NgxTvModule {\n  static forRoot(config?: NgxTvConfig): ModuleWithProviders<NgxTvModule> {\n    return {\n      ngModule: NgxTvModule,\n      providers: [\n        {\n          provide: NGX_TV_CONFIG,\n          useValue: getConfig(config),\n        },\n        { provide: TRANSLOCO_SCOPE, useValue: getConfig(config).scope },\n      ],\n    };\n  }\n\n  static forChild(): ModuleWithProviders<NgxTvModule> {\n    return {\n      ngModule: NgxTvModule,\n    };\n  }\n}\n","/*\n * Public API Surface of ngx-translation-validation\n */\n\nexport * from './lib/ngx-tv.directive';\nexport * from './lib/ngx-tv-scope.directive';\nexport * from './lib/ngx-tv-container.directive';\nexport * from './lib/ngx-tv-form.directive';\nexport * from './lib/ngx-tv.config';\nexport * from './lib/ngx-tv-container/ngx-tv-container.component';\nexport * from './lib/ngx-tv.module';\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":[],"mappings":"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"}